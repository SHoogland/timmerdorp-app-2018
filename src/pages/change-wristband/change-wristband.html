<ion-content padding>
	<ion-header>
		<ion-icon (click)="goHome()" class='homeIcon' name="md-home"></ion-icon>
		<h1 (click)="goHome()" id="ptitle">Timmerdorp</h1>
		<ion-navbar>
			<ion-title>
				<img (click)="goHome()" src="assets/imgs/logo.png" class="nav-logo">
			</ion-title>
		</ion-navbar>
	</ion-header>
	<h1 id='title' style='text-align: center;'>Verander Polsbandnummer</h1>
	<div class='content'>
		<div class="bracelet-number">
			<h3>Oud nummer</h3>
			<ion-item>
				<ion-input #nrInput type='tel' placeholder="Huidig polsbandje" [(ngModel)]="oldNr" (ngModelChange)='valueChanged()' maxlength='3'>
				</ion-input>
			</ion-item>
			<span *ngIf="wristBandError" class="form-error">
				{{ wristBandError }}
			</span>
		</div>

		<button [ngClass]="{'shown': (oldNr||'').length >= 3 }" ion-button full (click)="searchTicket()"
			class="bg-blue correction" style='z-index:400;position:relative;margin-top:0;'>
			<ion-icon slot='start' name='search' style='margin-right:12px;position:relative;font-size:1.8em;'>
			</ion-icon>
			Zoeken
		</button>

		<ion-list *ngIf="!searched && !error && !loading && history && history.length > 0">
			<ion-list-header>
				Wijzigingsgeschiedenis
			</ion-list-header>


			<ion-item *ngFor="let h of history">
				<ion-label>
					<ion-icon name='person' style='position: fixed;font-size:3.5em;left: 35px;'
						[ngStyle]='{"color": h.wijk}'></ion-icon>
					<div style='position:relative; left: 80px;'>
						<h2>{{h.name}}</h2>
						<p><b>Oud polsbandje:</b> {{h.oldNr}}</p>
						<p><b>Nieuw polsbandje:</b> {{h.newNr}}</p>
					</div>
					<ion-button size="small" (click)='oldNr=""+h.newNr;searched=true;searchTicket()'
						style='background: #2196f3;padding: 11px;border-radius: 4px;color: white;right: 0px;top: 15px;position: absolute;'>
						Zoeken</ion-button>
				</ion-label>
			</ion-item>
		</ion-list>


		<div class="user-info">
			<span *ngIf="!loginError&&!notLoggedIn" style="color:red;font-weight:bold">
				{{error}}
			</span>
			<span *ngIf="loginError" style="color:red;font-weight:bold">
				Login-gegevens onjuist. <a (click)='toLogin()'>Aanpassen</a>
			</span>
			<span *ngIf="notLoggedIn" style="color:red;font-weight:bold">
				Je moet eerst <a (click)='toLogin()'>inloggen</a>!
			</span>
			<div style='height: 20px;'>
				<div *ngIf="loading&&!notLoggedIn">
					<ion-spinner color='primary'></ion-spinner>
				</div>
			</div>
		</div>

		<div class="user-info" *ngIf="searched">
			<h1>Kind #{{oldNr}}</h1>
			<b>Naam: </b>{{ticket.firstName}} {{ticket.lastName}}
			<br><b>Ticket-barcode: </b>{{ticket.barcode}}
			<br><b>Geboortedatum: </b> {{ticket.birthDate}}
			<div *ngIf='ticket.hutnr'><b>Hutnummer: </b> {{ticket.hutnr}}</div>
			<h3>Nieuw nummer</h3>
			<ion-item>
				<ion-input #nrInput type='tel' placeholder="Nieuw polsbandje" [(ngModel)]="newNr" id='secondInput'
					maxlength='3'>
				</ion-input>
			</ion-item>
			<button [ngClass]="{'shown': (newNr||'').length >= 3 }" ion-button full (click)="saveNr()"
				class="bg-blue correction">
				<ion-icon slot='start' name='checkmark' style='margin-right:12px;position:relative;font-size:1.8em;'>
				</ion-icon>
				Opslaan
			</button>
			<div style='height: 20px;'>
				<div *ngIf="loading2">
					<ion-spinner color='primary'></ion-spinner>
				</div>
			</div>
		</div>
	</div>
</ion-content>